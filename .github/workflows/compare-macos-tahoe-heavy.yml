name: "‚öîÔ∏è Runner Battle: GitHub vs GetMac.io"

on:
  workflow_dispatch:

jobs:
  benchmark:
    name: ${{ matrix.provider }} (${{ matrix.os }})
    strategy:
      fail-fast: false
      matrix:
        include:
          # --- CONTENDER 1: GitHub Hosted ---
          - provider: 'GitHub Cloud'
            # 'macos-15' is Sequoia. If GitHub has released 'macos-26' image, use that.
            # In early 2026, 'macos-latest' likely points to macOS 15 or 16.
            runner: macos-26
            os: 'GitHub macOS Tahoe'

          # --- CONTENDER 2: GetMac.io (Self-Hosted) ---
            # IMPORTANT: Ensure your GetMac.io runner has these labels or update this line
            # You must manually update this machine to macOS 26 Tahoe to test "Version 26"
          - provider: 'GetMac.io'
            runner: getmac-tahoe
            os: 'GetMac macOS Tahoe '

    runs-on: ${{ matrix.runner }}

    steps:
      - name: Checkout Benchmark Repo
        uses: actions/checkout@v4
        with:
          repository: devMEremenko/XcodeBenchmark
          ref: master

      - name: üîç Check Specs
        run: |
          echo "--- Hardware Info ---"
          system_profiler SPHardwareDataType | grep "Memory"
          system_profiler SPHardwareDataType | grep "Chip"

          echo "--- Remote Access Info ---"
          echo "ssh:"
          sudo systemsetup -getremotelogin
          echo "vnc:"
          launchctl list | grep -E 'com.apple.screensharing|com.apple.RemoteDesktop'

          echo "--- Software Info ---"
          sw_vers
          xcodebuild -version
        shell: bash

      - name: "üì¶ Install Dependencies (CocoaPods)"
        run: |
          # We run this to ensure the workspace and pod linkages are generated correctly
          # for the current machine's architecture.
          pod install --repo-update
        shell: bash

      - name: "üèãÔ∏è Run Heavy Load"
        run: |
          xcodebuild -workspace XcodeBenchmark.xcworkspace \
            -scheme XcodeBenchmark \
            -destination 'generic/platform=iOS' \
            clean build \
            COMPILER_INDEX_STORE_ENABLE=NO \
            CODE_SIGNING_ALLOWED=NO \
            CODE_SIGNING_REQUIRED=NO \
            CODE_SIGN_IDENTITY="" \
            -parallelizeTargets \
            -jobs 8 \
            -quiet
        shell: bash

      - name: ‚è±Ô∏è Report Time
        if: always()
        run: |
          echo "Build finished on ${{ matrix.provider }}"
